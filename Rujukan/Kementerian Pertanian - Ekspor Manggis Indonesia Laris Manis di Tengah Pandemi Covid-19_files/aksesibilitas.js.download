
var accesibilityObj = {
  storageKey : 'accessibility_option',
  sessionKey : 'accessibility_state',
  config : {
    'contrastIndicatorBar' : 0,
    'cursorIndicatorBar' : 0,
    'fontSizeIndicatorBar' : 0,
    'letterSpaceIndicatorBar' : 0,
    'animationPausedIndicator' : 0,
    'legibleFontIndicator' : 0,
    'lineHeightIndicatorBar' : 0,
    'textAlignIndicatorBar' : 0,
    'saturationIndicatorBar' : 0,
    'linkIndicatorBar' : 0,
    'ttsInfo' : true,
    'ttsOnIndicator' : 0
  },

  state : {
    'is_open' : false,
  }, 
  
  saveToStorage : function() {
    localStorage.setItem(this.storageKey, JSON.stringify(this.config));
  },
  
  saveState : function() {
    sessionStorage.setItem(this.sessionKey, JSON.stringify(this.state));
  },

  loadFromStorage : function() {
    var storeValue = localStorage.getItem(this.storageKey);
    if (storeValue !== null) this.config = JSON.parse(storeValue);
    
    var sessionStore = sessionStorage.getItem(this.sessionKey);
    if (sessionStore !== null) this.state = JSON.parse(sessionStore);

  },

  applyConfig : function() {
    for (var key in this.config) {
        if (this.config.hasOwnProperty(key)) {
          var funcName = 'set_'+key;
          if (typeof window['accesibilityObj'][funcName] !== 'undefined')
            window['accesibilityObj'][funcName](this.config[key]);
        }
    }    

  },

  resetConfig : function() {
    this.config = {
      'contrastIndicatorBar' : 0,
      'cursorIndicatorBar' : 0,
      'fontSizeIndicatorBar' : 0,
      'letterSpaceIndicatorBar' : 0,
      'animationPausedIndicator' : 0,
      'legibleFontIndicator' : 0,
      'lineHeightIndicatorBar' : 0,
      'textAlignIndicatorBar' : 0,
      'saturationIndicatorBar' : 0,
      'linkIndicatorBar' : 0,
      'ttsInfo' : true,
      'ttsOnIndicator' : 0      
    }

    this.saveToStorage()
    this.applyConfig()
  },

  set_contrastIndicatorBar : function(val) {
    var el = $('#aks_contrast')

    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Warna Negatif')
          $('html').addClass('aks-invert')      
        break;

      case 2 : 
          el.find('span').text('Kontras Gelap')
          $('html').removeClass('aks-invert')
          $('html').addClass('aks-dark-contrast')      
        break;

      case 3 : 
          el.find('span').text('Kontras Terang')
          $('html').removeClass('aks-dark-contrast')
          $('html').addClass('aks-light-contrast')      
        break;

      default :
        $('#aks_contrast span').text('Kontras')
        $('#aks_contrast .indicator').removeClass('active')
        $('#aks_contrast section>div').removeClass('active')
        $('html').removeClass('aks-invert')
        $('html').removeClass('aks-dark-contrast')
        $('html').removeClass('aks-light-contrast')
        val = 0;
    }

    this.config.contrastIndicatorBar = val;
  },

  set_cursorIndicatorBar : function(val) {
    var el = $('#aks_cursor');

    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Kursor Besar')
          $('html').addClass('aks-cursor')
          el.find('div>svg').hide()
          el.find('.aksi-mouse-pointer').show()   
        break;

      case 2 : 
          el.find('span').text('Fokus Membaca')
          $('html').removeClass('aks-cursor')
          $('html').addClass('aks-readmask-on')
          // el.find('div>svg').hide()
          el.find('.aksi-mouse-pointer').hide()
          el.find('.fokus-baca').show() 
        break;

      case 3 : 
          el.find('span').text('Panduan Membaca')
          $('html').removeClass('aks-readmask-on')
          $('html').addClass('aks-readguide-on')
          el.find('div>svg').hide()
          el.find('.panduan-baca').show()
        break;

      default :
        $('#aks_cursor span').text('Kursor')
        $('#aks_cursor .indicator').removeClass('active')
        $('#aks_cursor section>div').removeClass('active')
        $('html').removeClass('aks-cursor')
        $('html').removeClass('aks-readmask-on')
        $('html').removeClass('aks-readguide-on')
        $('#aks_cursor div>svg').hide()
        $('#aks_cursor .aksi-mouse-pointer').show()
        val = 0;
    }

    this.config.cursorIndicatorBar = val;
  },

  set_fontSizeIndicatorBar : function(val) {
    var el = $('#aks_font_size');

    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }
    
    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          $('html').addClass('aks-font110')
        break;

      case 2 : 
          $('html').removeClass('aks-font110')
          $('html').addClass('aks-font115')
        break;

      case 3 : 
          $('html').removeClass('aks-font115')
          $('html').addClass('aks-font120')
        break;

      case 4 : 
          $('html').removeClass('aks-font120')
          $('html').addClass('aks-font125')
        break;

      default :
        $('#aks_font_size').find('.indicator').removeClass('active')
        $('#aks_font_size').find('section>div').removeClass('active')
        $('html').removeClass('aks-font110')
        $('html').removeClass('aks-font115')
        $('html').removeClass('aks-font120')
        $('html').removeClass('aks-font125')
        val = 0;
    }

    this.config.fontSizeIndicatorBar = val;
  },

  set_letterSpaceIndicatorBar : function(val) {
    var el = $('#aks_letter_spacing');

    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }
    
    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Sedikit Berjarak')
          $('html').addClass('aks-ltrspc1')
        break;

      case 2 : 
          el.find('span').text('Berjarak Sedang')
          $('html').removeClass('aks-ltrspc1')
          $('html').addClass('aks-ltrspc2')
        break;

      case 3 : 
          el.find('span').text('Renggang')
          $('html').removeClass('aks-ltrspc2')
          $('html').addClass('aks-ltrspc3')
        break;

      default :
        $('#aks_letter_spacing span').text('Jarak Huruf')
        $('#aks_letter_spacing .indicator').removeClass('active')
        $('#aks_letter_spacing section>div').removeClass('active')
        $('html').removeClass('aks-ltrspc1')
        $('html').removeClass('aks-ltrspc2')
        $('html').removeClass('aks-ltrspc3')
        val = 0;
    }

    this.config.letterSpaceIndicatorBar = val;
  },

  set_animationPausedIndicator : function(val) {
    var el = $('#aks_pause_animation');
    
    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Jalankan Animasi')
          $('html').addClass('aks-pause-animation')
          el.find('.aksi-pause-circle').hide()
          el.find('.aksi-play-circle').show()
        break;

      default :
        el.find('.aksi-play-circle').hide()
        $('#aks_pause_animation span').text('Jeda Animasi')
        $('#aks_pause_animation .indicator').removeClass('active')
        $('html').removeClass('aks-pause-animation')
        $('#aks_pause_animation div>svg').hide()
        $('#aks_pause_animation .aksi-pause-circle').show()
        val = 0;
    }

    this.config.animationPausedIndicator = val;
  },

  set_legibleFontIndicator : function(val) {
    var el = $('#aks_dyslexia');
    
    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Ramah Disleksia')
          $('html').addClass('aks-dyslexia')
        break;      

      case 2 :
          el.find('span').text('Mudah Terbaca')
          $('html').removeClass('aks-dyslexia')
          $('html').addClass('aks-legible')
        break;

      default :
        $('#aks_dyslexia span').text('Ramah Disleksia')
        $('#aks_dyslexia .indicator').removeClass('active')
        $('#aks_dyslexia section>div').removeClass('active')
        $('html').removeClass('aks-dyslexia')
        $('html').removeClass('aks-legible')
        val = 0;
    }

    this.config.legibleFontIndicator = val;
  },

  set_lineHeightIndicatorBar : function(val) {
    var el = $('#aks_line_height');
    
    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Jarak 1,5x')
          $('html').addClass('aks-line-height150')
        break;      

      case 2 :
          el.find('span').text('Jarak 1,75x')
          $('html').removeClass('aks-line-height150')
          $('html').addClass('aks-line-height175')
        break;

      case 3 :
          el.find('span').text('Jarak 2x')
          $('html').removeClass('aks-line-height175')
          $('html').addClass('aks-line-height200')
        break;

      default :
        $('#aks_line_height span').text('Jarak Baris')
        $('#aks_line_height .indicator').removeClass('active')
        $('#aks_line_height section>div').removeClass('active')
        $('html').removeClass('aks-line-height150')
        $('html').removeClass('aks-line-height175')
        $('html').removeClass('aks-line-height200')
        val = 0;
    }

    this.config.lineHeightIndicatorBar = val;
  },

  set_textAlignIndicatorBar : function(val) {
    var el = $('#aks_text_align');
    
    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Rata Kiri')
          el.find('.aksi-align-justify').hide()
          el.find('.aksi-align-left').show()
          $('html').addClass('aks-align-left')
        break;      

      case 2 :
          el.find('span').text('Rata Kanan')
          el.find('.aksi-align-left').hide()
          el.find('.aksi-align-right').show()
          $('html').removeClass('aks-align-left')
          $('html').addClass('aks-align-right')
        break;

      case 3 :
          el.find('span').text('Rata Tengah')
          el.find('.aksi-align-right').hide()
          el.find('.aksi-align-center').show()
          $('html').removeClass('aks-align-right')
          $('html').addClass('aks-align-center')
        break;

      case 4 :
          el.find('span').text('Sama Rata')
          el.find('.aksi-align-center').hide()
          el.find('.aksi-align-justify').show()
          $('html').removeClass('aks-align-center')
          $('html').addClass('aks-align-justify')
        break;

      default :
        $('#aks_text_align span').text('Perataan Teks')
        $('#aks_text_align div>svg').hide()
        $('#aks_text_align .aksi-align-left').show()
        $('#aks_text_align .indicator').removeClass('active')
        $('#aks_text_align section>div').removeClass('active')
        $('html').removeClass('aks-align-left')
        $('html').removeClass('aks-align-center')
        $('html').removeClass('aks-align-right')
        $('html').removeClass('aks-align-justify')
        val = 0;
    }

    this.config.textAlignIndicatorBar = val;
  },

  set_saturationIndicatorBar : function(val) {
    var el = $('#aks_saturation');
    
    for (var i=1; i<=val; i++) {
      el.find('section>div:nth-child('+i+')').addClass('active')
    }

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Saturasi Rendah')
          $('html').addClass('aks-low-saturate')
        break;      

      case 2 :
          el.find('span').text('Saturasi Tinggi')
          $('html').removeClass('aks-low-saturate')
          $('html').addClass('aks-hi-saturate')
        break;

      case 3 :
          el.find('span').text('Desaturasi')
          $('html').removeClass('aks-hi-saturate')
          $('html').addClass('aks-desaturate')
        break;

      default :
        $('#aks_saturation span').text('Saturasi')
        $('#aks_saturation .indicator').removeClass('active')
        $('#aks_saturation section>div').removeClass('active')
        $('html').removeClass('aks-low-saturate')
        $('html').removeClass('aks-hi-saturate')
        $('html').removeClass('aks-desaturate')
        val = 0;
    }

    this.config.saturationIndicatorBar = val;
  },

  set_ttsOnIndicator : function(val) {
    var el = $('#aks_tts');

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('span').text('Pembaca Layar')
          $('html').addClass('aks-tts-on')
          el.find('.aksi-volume-up').show()
          el.find('.aksi-volume-mute').hide()
        break;      

      default :
        el.find('.aksi-volume-mute').hide() 
        $('#aks_tts span').text('Pembaca Layar')
        $('#aks_tts .indicator').removeClass('active')
        $('html').removeClass('aks-tts-on')
        $('#aks_tts .aksi-volume-up').hide()
        $('#aks_tts .aksi-volume-mute').show()
        val = 0;
    }

    this.config.ttsOnIndicator = val;
  },

  set_linkIndicatorBar : function(val) {
    var el = $('#aks_link');

    if (val > 0) el.find('.indicator').addClass('active')

    switch (val) {
      case 1 :
          el.find('.indicator').addClass('active');
          $('html').addClass('aks-link');
        break;      

      default :
        el.find('.indicator').removeClass('active');
        $('html').removeClass('aks-link');
        val = 0;
    }

    this.config.linkIndicatorBar = val;
  },


}

$(document).ready(function() {
  accesibilityObj.loadFromStorage();
  accesibilityObj.applyConfig();
  
  if (accesibilityObj.state.is_open) {
    $('.aksesibilitas-menu').removeClass('hide');
    $('#aksesibilitas').removeClass('attn');
  }
});

// Toggle menu
$('#aksesibilitas').click(function () {
  $('.aksesibilitas-menu').removeClass('hide')
  $('#aksesibilitas').removeClass('attn')
  accesibilityObj.state.is_open = true;
  accesibilityObj.saveState();
  // openSound.play()
})

$('#aksesibilitas_close').click(function () {
  $('.aksesibilitas-menu').addClass('hide')
  $('#aksesibilitas').addClass('attn')
  accesibilityObj.state.is_open = false;
  accesibilityObj.saveState();
  // clickSound.play()
})

// Kontras
$('#aks_contrast').click(function () {
  accesibilityObj.set_contrastIndicatorBar(accesibilityObj.config.contrastIndicatorBar+1);  
  accesibilityObj.saveToStorage();
})

// link
$('#aks_link').click(function () {  
  accesibilityObj.set_linkIndicatorBar(accesibilityObj.config.linkIndicatorBar+1);  
  accesibilityObj.saveToStorage();
})

// kursor
$('#aks_cursor').click(function () {
  accesibilityObj.set_cursorIndicatorBar(accesibilityObj.config.cursorIndicatorBar+1);  
  accesibilityObj.saveToStorage();
})


// Reading
$(document).on('mousemove', function (event) {
  // Reading Mask
  var windowHeight = window.innerHeight
  $('#aks_top_mask').height(event.clientY - 60)
  $('#aks_bottom_mask').height(windowHeight - event.clientY - 60)
  // Reading Guide
  $('#aks_readguide_bar').css({
    top: event.clientY - 20,
    left: event.clientX - 280,
  })
  $('#aks_readguide_tip').css({
    top: event.clientY - 20,
    left: event.clientX - 10,
  })
  $('#aks_readguide_tip2').css({
    top: event.clientY - 20,
    left: event.clientX - 10.5,
  })
})

// font-size
$('#aks_font_size').click(function () {
  accesibilityObj.set_fontSizeIndicatorBar(accesibilityObj.config.fontSizeIndicatorBar+1);
  accesibilityObj.saveToStorage();
})

// letter spacing
$('#aks_letter_spacing').click(function () {
  accesibilityObj.set_letterSpaceIndicatorBar(accesibilityObj.config.letterSpaceIndicatorBar+1);
  accesibilityObj.saveToStorage();  
})

// pause animation
$('#aks_pause_animation').click(function () {
  accesibilityObj.set_animationPausedIndicator(accesibilityObj.config.animationPausedIndicator+1);
  accesibilityObj.saveToStorage();    
})

// Dyslexia
$('#aks_dyslexia').click(function () {
  accesibilityObj.set_legibleFontIndicator(accesibilityObj.config.legibleFontIndicator+1);
  accesibilityObj.saveToStorage();    
})


// line height
$('#aks_line_height').click(function () {
  accesibilityObj.set_lineHeightIndicatorBar(accesibilityObj.config.lineHeightIndicatorBar+1);
  accesibilityObj.saveToStorage();    
})

// text align
$('#aks_text_align').click(function () {
  accesibilityObj.set_textAlignIndicatorBar(accesibilityObj.config.textAlignIndicatorBar+1);
  accesibilityObj.saveToStorage();  
})


// Saturation
$('#aks_saturation').click(function () {
  accesibilityObj.set_saturationIndicatorBar(accesibilityObj.config.saturationIndicatorBar+1);
  accesibilityObj.saveToStorage();
})


// TTS
$(
  'a,p,:header,span,.today,button,.stock-list>.row,.aksesibilitas-body>div,.entry-content>div',
).hover(
  function () {
    if ($('html').hasClass('aks-tts-on')) {
      $(this).addClass('highlight-text')
      responsiveVoice.speak($(this).text(), 'Indonesian Female', { pitch: 1 })
    }
  },
  function () {
    $(this).removeClass('highlight-text')
  },
)


$('#aks_tts').hover(
  function () {
    if (!$('html').hasClass('aks-tts-on')) {
      if (ttsInfo) {
        $(this).find('svg').addClass('pulse tts-on')
        var that = this
        timer = setTimeout(function () {
          responsiveVoice.speak(
            'Klik di sini untuk mengaktifkan pembaca Layar',
            'Indonesian Female',
            { pitch: 1 },
          )
        }, 100)
        ttsInfo = false
      }
    }
  },
  function () {
    clearTimeout(timer)
    setTimeout(() => {
      $(this).find('svg').removeClass('pulse tts-on')
    }, 7000)
  },
)

$('#aks_tts').click(function () {
  if (accesibilityObj.config.ttsOnIndicator == 0) {
    responsiveVoice.speak('Pembaca Layar diaktifkan', 'Indonesian Female', {
      pitch: 1
    })
  } else if (accesibilityObj.config.ttsOnIndicator == 1) {
    responsiveVoice.speak('Pembaca Layar dinonaktifkan', 'Indonesian Female', {
      pitch: 1
    })
  }

  accesibilityObj.set_ttsOnIndicator(accesibilityObj.config.ttsOnIndicator+1);
  accesibilityObj.saveToStorage();
})

$('#aks_reset').click(function () {
  accesibilityObj.resetConfig();
})

